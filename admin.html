<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8" />
<title>Koning Dodo Admin</title>
<style>
  body { font-family: Arial; background: #0a0a0a; color: #fff; margin: 0; padding: 20px; }
  h1 { color: #ff8c00; }
  button { background: #ff8c00; border: none; padding: 5px 10px; margin: 5px; cursor: pointer; }
  table { width: 100%; border-collapse: collapse; margin-top: 20px; }
  th, td { border: 1px solid #555; padding: 5px; text-align: left; }
  th { background: #006400; }
  tr:nth-child(even) { background: #111; }
</style>
</head>
<body>

<h1>Koning Dodo Admin Dashboard</h1>

<div id="loginDiv">
  <p>Voer admin wachtwoord in:</p>
  <input type="password" id="adminPass" placeholder="Wachtwoord">
  <button onclick="login()">Login</button>
  <p id="loginMsg" style="color:red;"></p>
</div>

<div id="dashboard" style="display:none;">
  <button onclick="loadBets()">Bets laden</button>
  <button onclick="resolveAll()">Alle Bets resolven</button>
  <button onclick="loadStats()">Stats laden</button>

  <h2>Alle Bets</h2>
  <div id="betsContainer"></div>

  <h2>Stats</h2>
  <div id="statsContainer"></div>
</div>

<script>
const ADMIN_PASSWORD = "admin123"; // dit kan later via environment variable

function login() {
  const pass = document.getElementById("adminPass").value;
  if(pass === ADMIN_PASSWORD) {
    document.getElementById("loginDiv").style.display = "none";
    document.getElementById("dashboard").style.display = "block";
  } else {
    document.getElementById("loginMsg").textContent = "Verkeerd wachtwoord!";
  }
}

async function loadBets() {
  const res = await fetch("/api/bets");
  const data = await res.json();
  const container = document.getElementById("betsContainer");
  if(data.ok) {
    let html = "<table><tr><th>User</th><th>Pick</th><th>Stake</th><th>Odds</th><th>Status</th></tr>";
    data.bets.forEach(b => {
      html += `<tr>
        <td>${b.user}</td>
        <td>${b.pick}</td>
        <td>€${b.stake.toLocaleString()}</td>
        <td>${b.odds}</td>
        <td>${b.status || "open"}</td>
      </tr>`;
    });
    html += "</table>";
    container.innerHTML = html;
  } else {
    container.textContent = "Fout bij laden bets";
  }
}

async function resolveAll() {
  const res = await fetch("/api/resolve-all");
  const data = await res.json();
  if(data.ok) {
    alert("Bets succesvol geresolved!");
    loadBets();
    loadStats();
  } else {
    alert("Fout bij resolven: " + data.error);
  }
}

async function loadStats() {
  const res = await fetch("/api/stats");
  const data = await res.json();
  const container = document.getElementById("statsContainer");
  if(data.ok) {
    let html = "<table><tr><th>User</th><th>Total Bets</th><th>Wins</th><th>Losses</th><th>Profit</th></tr>";
    Object.entries(data.stats).forEach(([user, stat]) => {
      html += `<tr>
        <td>${user}</td>
        <td>${stat.totalBets}</td>
        <td>${stat.wins}</td>
        <td>${stat.losses}</td>
        <td>€${stat.profit.toLocaleString()}</td>
      </tr>`;
    });
    html += "</table>";
    container.innerHTML = html;
  } else {
    container.textContent = "Fout bij laden stats";
  }
}
</script>

</body>
</html>
